image:
  repository: 043902793725.dkr.ecr.ap-southeast-1.amazonaws.com/frontend
  tag: latest
imagePullSecrets:
- name: ecr-credentials
deployments:
- name: frontend
  replicasCount: 1
  istioEnabled: true  
  prometheusEnabled: true
  service:
    name: frontend
    HTTPPort: 80
    health:
      live: "/_healthz"
      ready: "/_healthz"
      initialDelaySeconds: 20
      periodSeconds: 10
      failureThreshold: 5
      timeoutSeconds: 3
port: 80
env:
  PORT: 80
  DISABLE_PROFILER: 0
  ENABLE_TRACING: 0
  AD_SERVICE_ADDR: "secret:frontend-secrets.AD_SERVICE_ADDR"
  RECOMMENDATION_SERVICE_ADDR: "secret:frontend-secrets.RECOMMENDATION_SERVICE_ADDR"
  CHECKOUT_SERVICE_ADDR: "secret:frontend-secrets.CHECKOUT_SERVICE_ADDR"
  PRODUCT_CATALOG_SERVICE_ADDR: "secret:frontend-secrets.PRODUCT_CATALOG_SERVICE_ADDR"
  SHIPPING_SERVICE_ADDR: "secret:frontend-secrets.SHIPPING_SERVICE_ADDR"
  PAYMENT_SERVICE_ADDR: "secret:frontend-secrets.PAYMENT_SERVICE_ADDR"
  EMAIL_SERVICE_ADDR: "secret:frontend-secrets.EMAIL_SERVICE_ADDR"
  CURRENCY_SERVICE_ADDR: "secret:frontend-secrets.CURRENCY_SERVICE_ADDR"
  CART_SERVICE_ADDR: "secret:frontend-secrets.CART_SERVICE_ADDR"
resources:
  requests:
    cpu: "100m"
    memory: "50Mi"
  limits:
    cpu: "100m"
    memory: "50Mi"
infisical:
  enabled: false
secretProviderClass:
  enabled: true
  name: frontend
  provider: aws
  parameters:
    region: ap-southeast-1
    objects: |
      - objectName: "tool-cluster-dev-general-secret"
        objectType: "secretsmanager"
        jmesPath:
          - path: REDIS_ADDR
            objectAlias: REDIS_ADDR
          - path: PRODUCT_CATALOG_SERVICE_ADDR
            objectAlias: PRODUCT_CATALOG_SERVICE_ADDR
          - path: SHIPPING_SERVICE_ADDR
            objectAlias: SHIPPING_SERVICE_ADDR
          - path: PAYMENT_SERVICE_ADDR
            objectAlias: PAYMENT_SERVICE_ADDR
          - path: EMAIL_SERVICE_ADDR
            objectAlias: EMAIL_SERVICE_ADDR
          - path: CURRENCY_SERVICE_ADDR
            objectAlias: CURRENCY_SERVICE_ADDR
          - path: CART_SERVICE_ADDR
            objectAlias: CART_SERVICE_ADDR
          - path: AD_SERVICE_ADDR
            objectAlias: AD_SERVICE_ADDR
          - path: RECOMMENDATION_SERVICE_ADDR
            objectAlias: RECOMMENDATION_SERVICE_ADDR
          - path: CHECKOUT_SERVICE_ADDR
            objectAlias: CHECKOUT_SERVICE_ADDR
  secretObjects:
  - secretName: "frontend-secrets"
    type: Opaque
    data:
    - key: "REDIS_ADDR"
      objectName: "REDIS_ADDR"
    - key: "PRODUCT_CATALOG_SERVICE_ADDR"
      objectName: "PRODUCT_CATALOG_SERVICE_ADDR"
    - key: "SHIPPING_SERVICE_ADDR"
      objectName: "SHIPPING_SERVICE_ADDR"
    - key: "PAYMENT_SERVICE_ADDR"
      objectName: "PAYMENT_SERVICE_ADDR"
    - key: "EMAIL_SERVICE_ADDR"
      objectName: "EMAIL_SERVICE_ADDR"
    - key: "CURRENCY_SERVICE_ADDR"
      objectName: "CURRENCY_SERVICE_ADDR"
    - key: "CART_SERVICE_ADDR"
      objectName: "CART_SERVICE_ADDR"
    - key: "AD_SERVICE_ADDR"
      objectName: "AD_SERVICE_ADDR"
    - key: "RECOMMENDATION_SERVICE_ADDR"
      objectName: "RECOMMENDATION_SERVICE_ADDR"
    - key: "CHECKOUT_SERVICE_ADDR"
      objectName: "CHECKOUT_SERVICE_ADDR"
serviceAccountName: "frontend"
serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::043902793725:role/tool-cluster-dev-secrets-csi-role
istio:
  enabled: true
  destinationRule:
    enabled: true
    host: frontend
    trafficPolicy: 
      outlierDetection:
        consecutive5xxErrors: 5
        interval: 30s              
        baseEjectionTime: 30s       
        maxEjectionPercent: 30
        minHealthPercent: 70      
  